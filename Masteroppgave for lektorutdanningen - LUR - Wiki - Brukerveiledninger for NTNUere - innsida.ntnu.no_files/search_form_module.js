AUI().add("ntnu-search-form",function(a){a.namespace("NTNU");a.NTNU.SearchForm=function(s,t){var b=new a.NTNU.ObjectUtil();var m=b.validateLiteral(s,["namespace","mainNodeID","inputNodeID"]);var k=a.one("#"+m.mainNodeID);var l=k.one("#"+m.inputNodeID);var o=k.one("form");var j=k.getAttribute("data-resourceurl");var h=a.one("#"+m.namespace+"miniresult");var v=k.one("#sok");var n=k.one(".searchindicator");var r=new a.DataSource.IO({source:j});var i=a.one(".ntnu-search-result-portlet");var w=b.get_param("query");if(w&&w.length>0){var d=b.encodeHTML(w);l.val(w)}var u=a.Node.create('<div id="searchFormTypeIndicatorNode"></div>');k.appendChild(u);a.on("ntnu:searchType:changed",function(){e.get("input").focus()});var e=new a.AutoComplete({dataSource:r,schema:{metaFields:{total:"total"},resultFields:[{key:"title"},{key:"teaser"},{key:"studyLevel"},{key:"orgName"},{key:"courseCode"},{key:"jsonData"},{key:"courseCredit"},{key:"studyProgCode"},{key:"body"},{key:"type"},{key:"url"},{key:"cellPhone"},{key:"email"},{key:"pictureUrl"},{key:"roleTitle"},{key:"personUrl"},{key:"docdatetime"},{key:"publicationDate"},{key:"channel"},{key:"channelName"},{key:"author"},{key:"address"},{key:"phone"},{key:"contentId"},{key:"id"}],resultListLocator:"searchResult"},schemaType:"json",matchKey:"title",typeAhead:false,minQueryLength:2,queryDelay:0.2,typeAheadDelay:0.5,queryInterval:0.3,contentBox:k,cssClass:"search-component",input:l});e.render();function y(z){n.show()}function q(z){n.hide()}e.on("dataRequest",y);e.on("dataReturn",q);e.get("input").on("click",function(){e.get("input").focus()});e.searchButton=k.one("#trigger");e.searchButton.hide();e.get("input").on("key",function(z){var A=z.currentTarget;a.fire("ntnu:hideMiniResult");a.fire("ntnu:sendSearch",A.val())},"down:13");e.get("input").on("key",function(z){z.preventDefault();a.fire("ntnu:hideMiniResult");a.fire("ntnu:tabToSearch")},"down:9");v.on("click",function(){var z=a.one(".ntnu-autocomplete-query").val();a.fire("ntnu:sendSearch",z)});a.on("ntnu:searchForm:setFocus",function(){try{a.one('#searchform input.ntnu-autocomplete-query[type="text"]').focus()}catch(z){a.log(z)}});e.get("input").on("key",function(z){a.fire("ntnu:hideMiniResult")},"down:27");e.get("input").on("key",function(z){a.fire("ntnu:searchresult:less")},"down:33+shift");e.get("input").on("key",function(z){a.fire("ntnu:searchresult:more")},"down:34+shift");e.on("autocomplete:dataRequest",function(){a.fire("ntnu:dosearch",g())});a.on("ntnu:search-context:searchlanguage:changed",function(){try{e.get("input").focus()}catch(z){a.log(z);return}});function g(){t.changePageNo(1);return t.buildQueryString(b.encodeHTML(e.get("input").val()))}function p(A){if(A){A.halt()}var z=a.one(".ntnu-search-result-area");if(z){if(A){A.halt()}a.fire("ntnu:dosearch",g())}}a.on("ntnu:miniresultfailure",p);o.on("submit",a.bind(p,this),this);a.on("ntnu:moreresult",a.bind(p,this));e.generateRequest=function(z){return{request:g(),cfg:{method:"POST"}}};e.resultArray=new Array();e.formatResult=function(A,B,z){this.resultArray.push(A)};var c={portletNameSpace:m.namespace,resultNode:h,inputNode:e.get("input")};e.miniResult=new a.NTNU.SearchMiniResult(c);e.doBeforeExpandContainer=function(A,z){this.miniResult.formatAjaxresponse(this.resultArray);this.miniResult.enableFocusManager();this.resultArray=new Array();if(!i){this.miniResult.showMiniResult()}return false};e.on("ntnu:hideMiniResult",function(){this.miniResult.hideMiniResult();this.resultArray=new Array();try{}catch(z){a.log(z);return}});a.on("ntnu:sendSearch",f);function f(F){var C=a.one("div[data-regulare-search]");var B=C.getAttribute("data-regulare-search");var A=a.one(".ntnu-search-result-portlet");var E=a.one("div[data-toppathurl]").getAttribute("data-toppathurl");var z=t.buildQueryData(F);var D=a.io.request(B,{method:"POST",autoLoad:false,data:z,on:{success:function(){var H=E+"/sok";var G=new NTNU.UrlNavigator({url:H});G.go()},failure:function(){a.log("failure i nytt request")}}});if(!A){D.start()}}(function x(){e.get("input").set("disabled",false);e.get("input").val("")})()}},"3.1.1",{requires:["ntnu-object-util","aui-node","aui-autocomplete","ntnu-kindereggs"]});