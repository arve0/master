AUI().add("ntnu-search-widgets",function(a){a.namespace("NTNU");a.NTNU.HistoryWidget=function(m,b){if(!m||!b||!Modernizr.localstorage){function f(){}return{addSearch:f,renderHistory:f,clearHistory:f}}var j=[];var l=10;var g=new a.NTNU.ObjectUtil();c();m.delegate("click",function(o){var n=o.currentTarget;b.parseQueryUrl(n.queryParameterString)},"a.search-history-link");a.on("ntnu:search-context:querybuild",function(n){d(n);k()});function d(q){var n=false;for(var o=0;o<j.length;o++){if(q==j[o]){n=true}}if(!n){var p=j.push(q);if(p>l){j.shift()}}}function k(){var p=a.Node.create('<ul class="queryHistoryList"></ul>');for(var o=0;o<j.length;o++){var n=j[o];p.appendChild(h(n))}m.empty();m.appendChild(a.Node.create("<h3></h3>").text("Mine siste sp√∏rringer"));m.appendChild(p);var q=a.Node.create('<a class="ntnu-search-widget-clear" href="javascript:void(0);">[clear]</a>');q.on("click",i);m.appendChild(q);m.appendChild(a.Node.create("<hr/>"));e(j)}function e(){if(Modernizr.localstorage){localStorage.setItem("ntnu-search-history-widget",j.toString())}else{a.log("No query or localStorage")}}function c(){if(Modernizr.localstorage){var n=localStorage.getItem("ntnu-search-history-widget")}else{a.log("No query or localStorage")}var o=new Array();if(n&&n.length>0){o=n.split(",")}j=o;k()}function h(p){var v=a.Node.create("<li></li>");var w=p.split("&");var s="";var t="";for(var q=0;q<w.length;q++){if(w[q].length>1){var o=w[q].split("=");var n=o[0];var u=o[1];if(n=="query"){s=u}else{if(n=="searchResultTypes"){t=u}}}}var r=a.Node.create('<a class="search-history-link"></a>').text(s+" ["+t+"]");r.setAttrs({href:"javascript:void(0);",title:s+" in type "+t});r.queryParameterString=p;v.setAttribute("data-searchType",t);v.appendChild(r);return v}function i(){j=new Array();if(Modernizr.localstorage){localStorage.setItem("ntnu-search-history-widget",j.toString())}k()}return{addSearch:d,renderHistory:k,clearHistory:i}};a.NTNU.ContactList=function(d){if(!d){a.log("no renderNode contactlist")}a.log("adding contactlist");var e=new a.NTNU.SearchResultFormater();a.on("ntnu:search-result:rendered",b);function b(){var f=a.all(".ntnu-search-result-employee");f.each(function(i){var g=i.getAttribute("data-contentid");var h=a.Node.create('<a href="javascript:void(0);" title="legg til contact">legg til</a>');h.setAttribute("data-contact-key",g);h.on("click",c);i.appendChild(h)})}function c(m){a.log("adding person");var l=m.currentTarget;var f=l.getAttribute("data-contact-key");if(f&&f.length>0){var i=a.one(".ntnu-search-result-area");var h=a.one("div[data-resourceurl].search-result").getAttribute("data-resourceurl");var j=i.getAttribute("data-resourceurl");var g={method:"POST",data:"query="+f+"&searchResultTypes=person&pageSize=20&pageNo=1&languages=no&languages=en",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},autoLoad:false,on:{success:function(){var q=a.JSON.parse(this.get("responseData"));if(q.searchResult.length>0){var p=q.searchResult[0];var n=a.JSON.stringify(p);a.log(n);if(Modernizr.localstorage){localStorage.setItem("ntnu-search-contact-widget",n)}var o=e.formatPerson(p);d.appendChild(o)}},failure:function(){a.log("failure i nytt request")}}};var k=a.io.request(h,g);k.start()}}}},"3.1.1",{requires:["aui-io","aui-node","widget","ntnu-object-util"]});