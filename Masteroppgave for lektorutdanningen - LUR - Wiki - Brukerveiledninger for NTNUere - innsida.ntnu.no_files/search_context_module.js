AUI().add("ntnu-search-context",function(a){a.namespace("NTNU");a.NTNU.SearchContextToolBarWidget=function(b){a.NTNU.SearchContextToolBarWidget.superclass.constructor.apply(this,arguments)};a.NTNU.SearchContextToolBarWidget.NAME="SearchContextToolBarWidget";a.NTNU.SearchContextToolBarWidget.ATTRS={searchContext:""};a.NTNU.SearchContextToolBarWidget.WRAPPERCLASS=a.ClassNameManager.getClassName(a.NTNU.SearchContextToolBarWidget.NAME,"searchChooser");a.NTNU.SearchContextToolBarWidget.TRIGGERCLASS=a.ClassNameManager.getClassName(a.NTNU.SearchContextToolBarWidget.NAME,"trigger");a.NTNU.SearchContextToolBarWidget.OVERLAYCLASS=a.ClassNameManager.getClassName(a.NTNU.SearchContextToolBarWidget.NAME,"overlay");a.NTNU.SearchContextToolBarWidget.ITEMCLASS=a.ClassNameManager.getClassName(a.NTNU.SearchContextToolBarWidget.NAME,"searchItem");a.NTNU.SearchContextToolBarWidget.ANCHORCLASS=a.ClassNameManager.getClassName(a.NTNU.SearchContextToolBarWidget.NAME,"searchItemLink");a.NTNU.SearchContextToolBarWidget.WRAPPER='<div class="'+a.NTNU.SearchContextToolBarWidget.WRAPPERCLASS+'"></div>';a.NTNU.SearchContextToolBarWidget.TRIGGER='<span class="'+a.NTNU.SearchContextToolBarWidget.TRIGGERCLASS+'"></span>';a.NTNU.SearchContextToolBarWidget.OVERLAY='<div class="'+a.NTNU.SearchContextToolBarWidget.OVERLAYCLASS+'"></div>';a.NTNU.SearchContextToolBarWidget.ITEM='<span class="'+a.NTNU.SearchContextToolBarWidget.ITEMCLASS+'"></span>';a.NTNU.SearchContextToolBarWidget.ITEMANCHOR='<a href="javascript:void(0);" class="'+a.NTNU.SearchContextToolBarWidget.ANCHORCLASS+'"></a>';a.NTNU.SearchContextToolBarWidget.LANG={web:'\u0049\u006e\u006e\u0068\u006f\u006c\u0064',person:'\u0050\u0065\u0072\u0073\u006f\u006e\u0065\u0072',message:'\u004d\u0065\u006c\u0064\u0069\u006e\u0067\u0065\u0072',course:'\u0045\u006d\u006e\u0065\u0072',studyprogramme:'\u0053\u0074\u0075\u0064\u0069\u0065\u0070\u0072\u006f\u0067\u0072\u0061\u006d',organization:'\u0045\u006e\u0068\u0065\u0074\u0065\u0072',all:'\u0049\u006e\u006e\u0073\u0069\u0064\u0061\u0020\u0028\u0061\u006c\u0074\u0029'};a.extend(a.NTNU.SearchContextToolBarWidget,a.Widget,{renderUI:function(){a.log(a.NTNU.SearchContextToolBarWidget.LANG);var k=this.get("contentBox");var d=a.Node.create(a.NTNU.SearchContextToolBarWidget.WRAPPER);var f=a.Node.create(a.NTNU.SearchContextToolBarWidget.OVERLAY);var h=this.get("searchContext").getAllSearchTypes();var e=a.Node.create(a.NTNU.SearchContextToolBarWidget.TRIGGER);e.text(a.NTNU.SearchContextToolBarWidget.LANG.all);for(var g=0;g<h.length;g++){var j=h[g];var c=a.Node.create(a.NTNU.SearchContextToolBarWidget.ITEM);c.addClass(j);var b=a.Node.create(a.NTNU.SearchContextToolBarWidget.ITEMANCHOR);b.text(a.NTNU.SearchContextToolBarWidget.LANG[j]);c.setAttribute("data-searchtype",j);c.append(b);f.append(c)}f.hide();d.append(e);d.append(f);k.append(d)},bindUI:function(){var b=this.get("contentBox");b.delegate("click",a.bind(this._clickHandler,this),"."+a.NTNU.SearchContextToolBarWidget.ITEMCLASS);b.delegate("click",a.bind(this._toggleDropDownHandler,this),"."+a.NTNU.SearchContextToolBarWidget.TRIGGERCLASS);a.one("body").on("click",a.bind(this._closeDropDown,this))},syncUI:function(){var b=this.get("searchContext");b.setSearchType("all");a.on("ntnu:search-context:searchconfig:loaded",a.bind(this._loadStateHandler,this));a.on("ntnu:search-context:searchtype:changed",a.bind(this._loadStateHandler,this))},_toggleDropDownHandler:function(d){d.halt();var c=d.currentTarget;var e=c.ancestor("."+a.NTNU.SearchContextToolBarWidget.WRAPPERCLASS);var b=e.one("."+a.NTNU.SearchContextToolBarWidget.OVERLAYCLASS);b.toggle()},_closeDropDown:function(){var b=this.get("contentBox").one("."+a.NTNU.SearchContextToolBarWidget.OVERLAYCLASS);b.hide()},_loadStateHandler:function(e){var b=e;if(e.searchType){b=e.searchType}var c=this.get("contentBox");var d=c.one("."+a.NTNU.SearchContextToolBarWidget.TRIGGERCLASS);d.text(a.NTNU.SearchContextToolBarWidget.LANG[b])},_clickHandler:function(f){f.halt();var d=this.get("searchContext");var e=f.currentTarget;var c=e.getAttribute("data-searchtype");var g=e.ancestor("."+a.NTNU.SearchContextToolBarWidget.WRAPPERCLASS);var b=g.one("."+a.NTNU.SearchContextToolBarWidget.TRIGGERCLASS);b.text(a.NTNU.SearchContextToolBarWidget.LANG[c]);d.changePageNo(1);d.setSearchType(c);this._toggleDropDownHandler(f);a.fire("ntnu:searchForm:setFocus")}});a.NTNU.SearchContext=function(c){this.util=new a.NTNU.ObjectUtil();this.yuiUtil=a.Lang;var b=this.util.validateLiteral(c,["searchTypes","languages"]);if(arguments.callee._singletonInstance){return arguments.callee._singletonInstance}arguments.callee._singletonInstance=this;this.allSearchTypesArr=b.searchTypes;this.allSearchLanguagesArr=b.languages;this.selectedSearchType="all";this.selectedSearchLanguagesArr=b.languages;this.query="";this.pageNo=1;this.pageSize="20"};a.NTNU.SearchContext.prototype.setSearchType=function(b){if(!b||typeof b!="string"||!(b.length>0)){throw new TypeError("ntnu:searchType:change :: searchType not an string, empty or length 0")}this.selectedSearchType=b;a.fire("ntnu:search-context:searchtype:changed",b)};a.NTNU.SearchContext.prototype.getSearchType=function(){return this.selectedSearchType};a.NTNU.SearchContext.prototype.getSearchTerm=function(){return this.query};a.NTNU.SearchContext.prototype.getAllSearchTypes=function(){return this.allSearchTypesArr};a.NTNU.SearchContext.prototype.getAllSearchLanguages=function(){return this.allSearchLanguagesArr};a.NTNU.SearchContext.prototype.getSelectedSearchLanguages=function(){return this.selectedSearchLanguagesArr};a.NTNU.SearchContext.prototype.changeSearchLanguage=function(c){if(!c||typeof c!="string"||!(c.length>0)){throw new TypeError("ntnu:searchLanguage:change :: searchLanguage not an string, empty or length 0")}var d=false;for(var b=0;b<this.selectedSearchLanguagesArr.length;b++){if(this.selectedSearchLanguagesArr[b]==c){this.selectedSearchLanguagesArr.splice(b,1);d=true}}if(!d){this.selectedSearchLanguagesArr.push(c)}a.fire("ntnu:search-context:searchlanguage:changed")};a.NTNU.SearchContext.prototype.loadState=function(c){if(c.languages&&c.languages.length>0&&this.yuiUtil.isArray(c.languages)){this.selectedSearchLanguagesArr=c.languages}if(c.searchResultTypes&&c.searchResultTypes.length>0){this.selectedSearchType=c.searchResultTypes}if(c.query&&c.query.length>0){this.query=c.query}if(c.pageNo){this.pageNo=c.pageNo}var b={searchType:c.searchResultTypes,selectedLangs:c.languages};a.fire("ntnu:search-context:searchconfig:loaded",b)};a.NTNU.SearchContext.prototype.parseQueryUrl=function(d){var e=d.substring(1);var j,g=[],h;var l=e.split("&");for(var f=0;f<l.length;f++){var c=l[f].split("=");var b=c[0];var k=c[1];if(b=="query"){h=k}else{if(b=="searchResultTypes"){j=k}else{if(b=="languages"){g.push(k)}}}}if(j&&g&&h){this.selectedSearchLanguagesArr=g;this.selectedSearchType=j;this.query=h;a.fire("ntnu:search-context:searchlanguage:changed",this.selectedSearchLanguagesArr);a.fire("ntnu:search-context:searchtype:changed",this.selectedSearchType)}};a.NTNU.SearchContext.prototype.hasBrowserValidQueryUrl=function(){var b=this.util.get_param("query");if(b&&b.length>0){return true}};a.NTNU.SearchContext.prototype.setQuery=function(b){if(!b||typeof b!="string"||!(b.length>0)){throw new TypeError("ntnu:searchLanguage:change :: searchLanguage not an string, empty or length 0")}this.query=b};a.NTNU.SearchContext.prototype.buildQueryString=function(b){if(b&&b.length>0){this.query=b}if(!(this.query.length>0)){a.log("no querystring to build from")}var d;d="&query="+this.query+"&pageSize="+this.pageSize+"&pageNo="+this.pageNo;d+="&searchResultTypes="+this.selectedSearchType;for(var c=0;c<this.selectedSearchLanguagesArr.length;c++){d+="&languages="+this.selectedSearchLanguagesArr[c]}return d};a.NTNU.SearchContext.prototype.buildQueryData=function(b){if(b&&b.length>0){this.query=b}return{query:this.query,pageSize:this.pageSize,pageNo:this.pageNo,searchResultTypes:this.selectedSearchType,languages:this.selectedSearchLanguagesArr}};a.NTNU.SearchContext.prototype.storeQuery=function(b){if(b&&typeof b=="string"&&b.length>0){if(Modernizr.localstorage){localStorage.setItem("search-portlet-query",b)}else{a.log("No query or localStorage")}}};a.NTNU.SearchContext.prototype.getStoredQuery=function(){var b;if(Modernizr.localstorage){b=localStorage.getItem("search-portlet-query")}return b};a.NTNU.SearchContext.prototype.changePageNo=function(b){if(!b||typeof b!="number"||b.valueOf()<0){throw new TypeError("_pageNo is not a number, less than 0 or undefined")}this.pageNo=b.valueOf();a.fire("ntnu:search-context-pageno:changed")};a.NTNU.SearchContext.prototype.getPageNo=function(){return this.pageNo}},"3.1.1",{requires:["aui-node","ntnu-object-util"]});