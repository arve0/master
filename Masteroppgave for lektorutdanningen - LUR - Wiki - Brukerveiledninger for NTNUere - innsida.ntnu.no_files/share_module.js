AUI({debug:"false"}).add("ntnu-copyMessageUrlWidget",function(a){a.namespace("NTNU");a.NTNU.CopyMessageUrlWidget=function(d){a.NTNU.CopyMessageUrlWidget.superclass.constructor.apply(this,arguments)};var c=a.NTNU.CopyMessageUrlWidget,b=a.Widget;c.NAME="CopyMessageUrlWidget";c.ATTRS={messageUri:{value:null,validator:function(d){return a.Lang.isString(d)}},channelUri:{value:""},triggerNode:null,widgetNode:{value:"message",validator:function(d){return a.Lang.isString(d)}},panelAddonWidgets:{value:[]},isInternal:{value:true}};c.LANG_MSG={shareLink:'\u0044\u0065\u006c\u0020\u006d\u0065\u006c\u0064\u0069\u006e\u0067\u0065\u006e',hideOverlay:'\u004c\u0075\u006b\u006b',copyLink:'\u0055\u0052\u004c',mailtoMailText:'\u006d\u0061\u0069\u006c\u0074\u006f\u003a\u003f\u0053\u0075\u0062\u006a\u0065\u0063\u0074\u003d\u004a\u0065\u0067\u0025\u0032\u0030\u0076\u0069\u006c\u0025\u0032\u0030\u0064\u0065\u006c\u0065\u0025\u0032\u0030\u0065\u006e\u0025\u0032\u0030\u006d\u0065\u006c\u0064\u0069\u006e\u0067\u0025\u0032\u0030\u0066\u0072\u0061\u0025\u0032\u0030\u0049\u006e\u006e\u0073\u0069\u0064\u0061\u0025\u0032\u0030\u006d\u0065\u0064\u0025\u0032\u0030\u0064\u0065\u0067\u0021\u0026\u0042\u006f\u0064\u0079\u003d',sendbymail:'\u0063\u006f\u0070\u0079\u0053\u0068\u0061\u0072\u0065\u004d\u0065\u0073\u0073\u0061\u0067\u0065\u002e\u0073\u0065\u006e\u0064\u0062\u0079\u006d\u0061\u0069\u006c',sendByMailLinkText:'',limitation:'\u004c\u0065\u006e\u006b\u0065\u006e\u0020\u0076\u0069\u006c\u0020\u0066\u0075\u006e\u0067\u0065\u0072\u0065\u0020\u0066\u006f\u0072\u0020\u0061\u006c\u006c\u0065\u0020\u0073\u006f\u006d\u0020\u0068\u0061\u0072\u0020\u0072\u0065\u0074\u0074\u0069\u0067\u0068\u0065\u0074\u0065\u0072\u0020\u0074\u0069\u006c\u0020\u00e5\u0020\u006c\u0065\u0073\u0065\u0020\u006d\u0065\u006c\u0064\u0069\u006e\u0067\u0065\u006e\u002e',shareBtn:'\u0044\u0065\u006c',heading:'\u0044\u0065\u006c\u0020\u0074\u0069\u006c\u0020\u0065\u0070\u006f\u0073\u0074'};c.LANG_CHN={shareLink:'\u0044\u0065\u006c\u0020\u006b\u0061\u006e\u0061\u006c\u0065\u006e',hideOverlay:'\u004c\u0075\u006b\u006b',copyLink:'\u0055\u0052\u004c',mailtoMailText:'\u006d\u0061\u0069\u006c\u0074\u006f\u003a\u003f\u0053\u0075\u0062\u006a\u0065\u0063\u0074\u003d\u004a\u0065\u0067\u0025\u0032\u0030\u0076\u0069\u006c\u0025\u0032\u0030\u0064\u0065\u006c\u0065\u0025\u0032\u0030\u0065\u006e\u0025\u0032\u0030\u006b\u0061\u006e\u0061\u006c\u0025\u0032\u0030\u0070\u00e5\u0025\u0032\u0030\u0049\u006e\u006e\u0073\u0069\u0064\u0061\u0025\u0032\u0030\u006d\u0065\u0064\u0025\u0032\u0030\u0064\u0065\u0067\u0021\u0026\u0042\u006f\u0064\u0079\u003d',sendbymail:'\u0063\u006f\u0070\u0079\u0053\u0068\u0061\u0072\u0065\u0043\u0068\u0061\u006e\u006e\u0065\u006c\u002e\u0073\u0065\u006e\u0064\u0062\u0079\u006d\u0061\u0069\u006c',sendByMailLinkText:'\u0041\u006e\u0062\u0065\u0066\u0061\u006c\u0020\u006b\u0061\u006e\u0061\u006c\u0065\u006e\u0020\u0074\u0069\u006c\u0020\u0061\u006e\u0064\u0072\u0065\u0020\u0076\u0069\u0061\u0020\u0065\u0070\u006f\u0073\u0074\u002e\u0020\u004d\u006f\u0074\u0074\u0061\u006b\u0065\u0072\u0065\u0020\u0076\u0069\u006c\u0020\u0065\u006e\u006b\u0065\u006c\u0074\u0020\u006b\u0075\u006e\u006e\u0065\u0020\u006b\u006c\u0069\u006b\u006b\u0065\u0020\u0070\u00e5\u0020\u0061\u0062\u006f\u006e\u006e\u0065\u0072\u002d\u006b\u006e\u0061\u0070\u0070\u0065\u006e\u0020\u0066\u006f\u0072\u0020\u00e5\u0020\u0062\u006c\u0069\u0020\u006d\u0065\u0064\u002e',limitation:'',shareBtn:'\u0044\u0065\u006c',heading:'\u0044\u0065\u006c\u0020\u0074\u0069\u006c\u0020\u0065\u0070\u006f\u0073\u0074'};a.extend(c,b,{renderUI:function(){var e=undefined;if(this.get("widgetNode")=="message"){e=a.NTNU.CopyMessageUrlWidget.LANG_MSG}else{e=a.NTNU.CopyMessageUrlWidget.LANG_CHN}var d=this.get("contentBox"),g=a.Node.create('<div class="copyShareMessageOverlayWrapper"><span class="shareBackground"></span></div>');g.append(a.Node.create('<a title="'+e.hideOverlay+'" href="javascript:void(0);" class="copyShareMessageOverlayHide"></a>'));g.append(a.Node.create('<span class="copyShareMessageOverlayHeader">'+e.shareLink+"</span>"));a.Array.each(this.get("panelAddonWidgets"),function(i){var h=a.Node.create("<div></div>").addClass("widgetAddon");i.render(h);g.append(h)});var f=this.createOverlayDom(this.get("messageUri"),this.get("channelUri"),g,e);if(this.get("triggerNode")==null){d.append(this.createShareBtn());f.hide()}if(!this.get("isInternal")){f.one(".emailshareBox").hide()}d.append(f)},bindUI:function(){var d=this.get("contentBox");d.delegate("focus",function(f){f.stopPropagation();var e=f.currentTarget;e.select()},".copyMessageUriOverlayInput");a.Array.each(this.get("panelAddonWidgets"),function(e){e.on("destroy",function(f){this.destroyAllChildWidgets();this.destroy()},this)},this);d.delegate("click",function(e){e.stopPropagation();this.destroyAllChildWidgets();this.destroy()},".copyShareMessageOverlayHide",this);if(this.get("triggerNode")==null){d.one(".shareMessageButton").on("click",function(){d.one(".copyShareMessageOverlayWrapper").show()})}this.on("destroy",function(){a.log("Destroying CopyMessageUrlWidget")})},syncUI:function(){a.log("share module sync")},destructor:function(){var e=this.get("contentBox"),d=e.ancestor("#shareThisLink")?e.ancestor("#shareThisLink"):e.ancestor(".shareThisLink");d.empty();d=null},destroyAllChildWidgets:function(){a.Array.each(this.get("panelAddonWidgets"),function(d){d.destroy()})},createShareBtn:function(){if(this.get("widgetNode")=="message"){var e=a.NTNU.CopyMessageUrlWidget.LANG_MSG}else{var e=a.NTNU.CopyMessageUrlWidget.LANG_CHN}var f=a.Node.create('<span class="shareMessageButtonText"></span>');f.text(e.shareBtn);var d=a.Node.create('<a href="javascript:void(0);" class="shareMessageButton btn btn-b"></a>');d.setAttribute("title",e.shareLink);d.append(f);return d},createOverlayDom:function(j,g,d,f){var h=a.Node.create('<div class="emailshareBox"></div>');h.append(a.Node.create('<h4 class="messageHeading"><span>'+f.heading+"</span></h4>"));h.append(a.Node.create('<span class="copyShareMessageOverlayText">'+f.copyLink+"</span>"));var l=a.Node.create('<div class="copyShareMessageOverlayMiddle"></div>');var i=a.Node.create('<input type="text" name="messageUri" readonly class="copyMessageUriOverlayInput"/>');var e="";if(g===""){i.val(j);e=f.mailtoMailText+j}else{i.val(j+"/channel/"+g);e=f.mailtoMailText+j+"/channel/"+g}l.append(i);h.append(l);var k=a.Node.create('<div class="copyShareMessageOverlayMailTo"></div>');k.append(a.Node.create('<a class="copyShareMessageOverlaySend btn btn-a" href="'+e+'">'+f.shareLink+"</a>"));h.append(k);if(f.limitation.length==0){f.limitation=f.sendByMailLinkText}h.append(a.Node.create('<span class="copyShareMessageOverlayLimitation">'+f.limitation+"</span>"));d.append(h);return d},getMessageUrl:function(){return this.get("messageUri")}})},"3.1.1",{requires:["aui-node","widget"]});