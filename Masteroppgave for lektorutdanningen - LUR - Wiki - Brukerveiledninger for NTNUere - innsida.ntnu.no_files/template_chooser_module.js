AUI.add("ntnu-template-chooser",function(a){a.namespace("NTNU");a.NTNU.TemplateChooser=function(g){var e=g.plid;var j=g.redirectUrl;var f=g.triggerBtnID;var i=a.one("#ntnu_layout-templates_overlay")||a.one("body").appendChild(a.Node.create('<div id="ntnu_layout-templates_overlay" class="aui-helper-hidden" aria-labelledby="ntnu_toolbar-link-layout-templates" aria-hidden="true"></div>'));if(f&&i){var d=new a.OverlayBase({boundingBox:i,zIndex:10000,visible:false,cssClass:"templates_overlay"});i.plug(a.LoadingMask,{background:"#ccc",height:"100%"});i.loadingmask.show()}var h=false;var c=function(p){d.toggle();if(i.hasClass("aui-overlay-hidden")){f.setAttribute("aria-pressed","true");i.setAttribute("aria-hidden","false")}else{f.setAttribute("aria-pressed","false");i.setAttribute("aria-hidden","true");i.loadingmask.show()}d.render();if(h){i.loadingmask.hide();return}var m=a.one("#template-chooser").attr("data-templatechooser-url");var l=a.one("#set-template-chooser").attr("data-templatechooser-url");var q=a.Node.create('<a class="btn btn-a" href="javascript:void(0);" role="button"></a>');q.text('\u0041\u0076\u0062\u0072\u0079\u0074');q.on("click",function(r){d.toggle()});var k=a.Node.create('<div id="resetLayoutInfoText"></div>');k.text('\u0054\u0072\u0079\u006b\u006b\u0020\u0072\u0065\u0073\u0065\u0074\u002d\u006b\u006e\u0061\u0070\u0070\u0065\u006e\u0020\u0066\u006f\u0072\u0020\u00e5\u0020\u0074\u0069\u006c\u0062\u0061\u006b\u0065\u0073\u0074\u0069\u006c\u006c\u0065\u0020\u0049\u006e\u006e\u0073\u0069\u0064\u0061\u0020\u0074\u0069\u006c\u0020\u0073\u0074\u0061\u006e\u0064\u0061\u0072\u0064\u006f\u0070\u0070\u0073\u0065\u0074\u0074\u002e');var n=a.Node.create('<a id="resetLayoutButton" class="btn btn-c" href="javascript:void(0);" role="button"></a>');n.text('\u0052\u0065\u0073\u0065\u0074');n.on("click",function(r){a.fire("ntnu:reset-page-settings")});var o=a.Node.create("<div></div>");i.appendChild(o);i.append(k);i.append(q);i.append(n);i.all("input[type=submit]").setAttribute("value","Ok");a.io.request(m,{dataType:"json",on:{success:function(){h=true;o.empty();i.loadingmask.hide();var r=this.get("responseData");if(r===null){return}a.each(r.templates,function(s){var t=a.Node.create('<div class="thumbnail" data-templateid="'+s.id+'"><img src="'+s.icon+'" alt="'+s.name+'"/></div');o.appendChild(t)});o.delegate("click",function(s){var t=s.currentTarget;a.io.request(l,{method:"post",data:{templateid:t.attr("data-templateid"),csrfToken:r.csrfToken},on:{success:function(){var u=this.get("responseData");document.location.href=j},failure:function(){a.log("Failed setting layoutdata")}}})},".thumbnail")},failure:function(){i.loadingmask.hide();a.log("failed on request!")}}})};f.on("click",c);var b=a.all(".ntnu-template-chooser-toggler");if(b){b.on("click",c)}}},"3.1.1",{requires:["aui-node","aui-io","aui-overlay"]});